# Harmonization Plan: NUCLEUS V5.3 Schema & Agent Definitions

## Goal Description
Analyze the "THE NUCLEUS V5.3" SQL schema provided by the user and harmonize it with the existing agent definitions found in the `dashboard-v3` workspace. This involves verifying that all agents (Egeria, Pulsar, Orion, Calliope, Argus, Planner) are correctly defined according to the new schema and reporting any discrepancies.

## User Review Required
- Confirmation of identified agent definitions location.
- Approval of proposed updates to agent registry files to match V5.3 schema.

## Proposed Changes
### Analysis Phase
1.  **Schema Breakdown**:
    -   **New**: `DROP POLICY IF EXISTS` added for idempotency.
    -   **New**: `diff_log` column in `ag_agent_memory` is now nullable.
    -   **New**: `justification_knowledge` and `justification_math` restored in `ag_logic_trace`.
2.  **Agent Discovery**:
    -   **Found**: Orion (`ORION_V3_4`) and Calliope (`CALLIOPE_V1_0`) in `src/agents`.
    -   **Missing Code**: Egeria, Pulsar, Argus, Planner not found in `src/agents`.
    -   **Discrepancy**: [agent_types.ts](file:///c:/Users/daria/.gemini/AXON/workspaces/Proyecto%20MENISCO/dashboard-v3/src/types/agent_types.ts) lists `CRONOS` and `NEXUS`, while User lists Egeria, Pulsar, Argus.
3.  **Gap Analysis**:
    -   Registry table needs ID, Name, Version, Role, Phases, Config.
    -   Existing code only partially supports this structure.

### Harmonization Phase (Planned)
1.  **Create Migration**: Generate `supbase/migrations/20260208_nucleus_v5_3_diamond_cut.sql` with the user's full SQL.
2.  **Update Types**: Modify [src/types/agent_types.ts](file:///c:/Users/daria/.gemini/AXON/workspaces/Proyecto%20MENISCO/dashboard-v3/src/types/agent_types.ts) to:
    -   Add `AgentRegistryRecord` interface.
    -   Update [SystemContext](file:///c:/Users/daria/.gemini/AXON/workspaces/Proyecto%20MENISCO/dashboard-v3/src/types/agent_types.ts#137-179) active_agent union to match User's list (Egeria, Pulsar, Orion, Calliope, Argus, Planner).
3.  **Create Central Registry**: Create `src/config/agent_registry.ts` to export the "Source of Truth" array for all 6 agents.
    -   Define roles/phases for Egeria, Pulsar, Argus, Planner (inferring or using placeholders).
4.  **Seed Update**: Generate a SQL seed script to insert/update all 6 agents in `ag_agent_registry`.

## Verification Plan
### Automated Verification
- **Schema Validation**: Use a script to validate that generated JSON/SQL matches the V5.3 schema constraints (e.g., checking enum values).
- **Consistency Check**: Verify that all agents in the "Hive" or known lists are present in the final registry.
